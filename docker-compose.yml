version: '3.8'

services:
  # Aplicación ELT - API Web
  elt-api:
    build: .
    container_name: eltmko-api
    restart: unless-stopped
    env_file:
      - .env.production  # Primero intenta producción
      - .env.docker      # Fallback para desarrollo local
    environment:
      API_HOST: 0.0.0.0
      API_PORT: 5000
    ports:
      - "${API_PORT:-5000}:5000"
    volumes:
      - ./config:/app/config
      - ./logs:/app/logs
    networks:
      - elt-network
    command: python api.py

  # Worker ELT - Sincronización Programada (opcional)
  elt-worker:
    build: .
    container_name: eltmko-worker
    restart: unless-stopped
    env_file:
      - .env.docker
    volumes:
      - ./config:/app/config
      - ./logs:/app/logs
    networks:
      - elt-network
    command: python main.py --mode scheduled
    profiles:
      - worker  # Este servicio solo se inicia si se especifica el perfil

networks:
  elt-network:
    driver: bridge
